<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Bill Splitter Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-7xl">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">Advanced Bill Splitter Calculator</h1>
            
            <!-- Total Bill and Units Input -->
            <div class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="totalBill" class="block text-sm font-medium text-gray-700 mb-2">Total Bill Amount (PKR)</label>
                    <input type="number" id="totalBill" placeholder="Enter total bill amount" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="totalUnits" class="block text-sm font-medium text-gray-700 mb-2">Total Units</label>
                    <input type="number" id="totalUnits" placeholder="Enter total units" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>

            <!-- People Grid -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Enter Consumed Units for Each Person</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="peopleGrid">
                    <!-- People inputs will be generated here -->
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
                <button onclick="generateBill()" 
                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                    Calculate Bill
                </button>
                <button onclick="clearAll()" 
                        class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-semibold">
                    Clear All
                </button>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden">
                <div class="border-t pt-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Bill Summary</h2>
                        <button onclick="printBill()" 
                                class="no-print px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            Print Bill
                        </button>
                    </div>
                    <div id="billResults"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const people = [
            { name: 'Haq Nawaz', id: 'haqNawaz', percentage: 16.62 },
            { name: 'Zafar Iqbal', id: 'zafarIqbal', percentage: 16.62 },
            { name: 'Yaseen', id: 'yaseen', percentage: 16.62 },
            { name: 'Sadiq', id: 'sadiq', percentage: 5.54 },
            { name: 'Bilal', id: 'bilal', percentage: 5.54 },
            { name: 'Mustafa', id: 'mustafa', percentage: 5.54 },
            { name: 'Haji Zafar', id: 'hajiZafar', percentage: 8.32 },
            { name: 'Ismail', id: 'ismail', percentage: 8.32 },
            { name: 'Sajjad Fareed', id: 'sajjadFareed', percentage: 4.15 },
            { name: 'Sabir', id: 'sabir', percentage: 4.15 },
            { name: 'Zahid', id: 'zahid', percentage: 2.06 },
            { name: 'Asghar', id: 'asghar', percentage: 2.06 },
            { name: 'Dr. Riaz', id: 'drRiaz', percentage: 1.01 },
            { name: 'Sadam', id: 'sadam', percentage: 1.01 },
            { name: 'Fazil', id: 'fazil', percentage: 1.01 },
            { name: 'Yousuf', id: 'yousf', percentage: 1.01 }
        ];

        // Generate people input fields
        function initializePeopleGrid() {
            const grid = document.getElementById('peopleGrid');
            grid.innerHTML = people.map(person => `
                <div class="bg-gray-50 p-3 rounded-lg">
                    <label for="${person.id}" class="block text-sm font-medium text-gray-700 mb-1">${person.name}</label>
                    <input type="number" id="${person.id}" placeholder="Consumed Units" min="0" step="0.1"
                           class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            `).join('');
        }

        function generateBill() {
            const totalBill = parseFloat(document.getElementById('totalBill').value);
            const totalUnits = parseFloat(document.getElementById('totalUnits').value);
            
            if (!totalBill || totalBill <= 0) {
                alert('Please enter a valid total bill amount');
                return;
            }

            if (!totalUnits || totalUnits <= 0) {
                alert('Please enter valid total units');
                return;
            }

            const pricePerUnit = totalBill / totalUnits;
            let totalConsumedUnits = 0;
            const billData = [];

            // Calculate total consumed units and prepare bill data
            people.forEach(person => {
                const consumedUnits = parseFloat(document.getElementById(person.id).value) || 0;
                totalConsumedUnits += consumedUnits;
                
                // Calculate share units based on percentage
                const shareUnits = (person.percentage / 100) * totalUnits;
                
                // Calculate extra units (difference between consumed and share)
                const extraUnits = consumedUnits - shareUnits;
                const extraUnitsCost = extraUnits * 10;
                
                billData.push({ 
                    name: person.name, 
                    shareUnits: shareUnits,
                    consumedUnits: consumedUnits,
                    extraUnits: extraUnits,
                    extraUnitsCost: extraUnitsCost
                });
            });

            if (totalConsumedUnits === 0) {
                alert('Please enter consumed units for at least one person');
                return;
            }

            // Calculate bill for each person
            billData.forEach(person => {
                const basicBill = person.consumedUnits * pricePerUnit;
                // Add extra cost for over-consumption, subtract for under-consumption
                person.totalBill = basicBill + person.extraUnitsCost;
            });

            // Filter out people with 0 consumed units for display
            const activeBillData = billData.filter(person => person.consumedUnits > 0);

            // Calculate totals
            const totalShareUnits = people.reduce((sum, p) => sum + (p.percentage / 100) * totalUnits, 0);
            const totalExtraUnits = activeBillData.reduce((sum, person) => sum + person.extraUnits, 0);
            const totalExtraUnitsCost = activeBillData.reduce((sum, person) => sum + person.extraUnitsCost, 0);
            const totalFinalBill = activeBillData.reduce((sum, person) => sum + person.totalBill, 0);

            // Generate summary
            const summaryHTML = `
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 text-center">
                        <div>
                            <div class="text-xl font-bold">${totalUnits.toFixed(1)}</div>
                            <div class="text-sm opacity-90">Total Units</div>
                        </div>
                        <div>
                            <div class="text-xl font-bold">${totalConsumedUnits.toFixed(1)}</div>
                            <div class="text-sm opacity-90">Consumed Units</div>
                        </div>
                        <div>
                            <div class="text-xl font-bold">PKR ${pricePerUnit.toFixed(2)}</div>
                            <div class="text-sm opacity-90">Price per Unit</div>
                        </div>
                        <div>
                            <div class="text-xl font-bold">PKR ${totalBill.toFixed(2)}</div>
                            <div class="text-sm opacity-90">Base Bill</div>
                        </div>
                        <div>
                            <div class="text-xl font-bold">PKR ${totalFinalBill.toFixed(2)}</div>
                            <div class="text-sm opacity-90">Final Total</div>
                        </div>
                    </div>
                </div>
            `;

            // Generate table
            const tableHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse bg-white rounded-lg overflow-hidden shadow-sm">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-200 px-3 py-3 text-left font-semibold text-gray-700">Name</th>
                                <th class="border border-gray-200 px-3 py-3 text-center font-semibold text-gray-700">Share's Units</th>
                                <th class="border border-gray-200 px-3 py-3 text-center font-semibold text-gray-700">Consumed Units</th>
                                <th class="border border-gray-200 px-3 py-3 text-center font-semibold text-gray-700">Extra Units</th>
                                <th class="border border-gray-200 px-3 py-3 text-center font-semibold text-gray-700">Extra Units Cost</th>
                                <th class="border border-gray-200 px-3 py-3 text-right font-semibold text-gray-700">Bill (PKR)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${activeBillData.map((person, index) => {
                                const consumedBgColor = person.consumedUnits > person.shareUnits ? 'bg-red-100' : 'bg-green-100';
                                const extraUnitsBgColor = person.extraUnits > 0 ? 'bg-red-100' : person.extraUnits < 0 ? 'bg-blue-100' : 'bg-gray-100';
                                const extraCostBgColor = person.extraUnitsCost > 0 ? 'bg-red-100' : person.extraUnitsCost < 0 ? 'bg-blue-100' : 'bg-gray-100';
                                const rowBgColor = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                                
                                return `
                                    <tr class="${rowBgColor} hover:bg-blue-50 transition-colors">
                                        <td class="border border-gray-200 px-3 py-3 font-medium">${person.name}</td>
                                        <td class="border border-gray-200 px-3 py-3 text-center">${person.shareUnits.toFixed(2)}</td>
                                        <td class="border border-gray-200 px-3 py-3 text-center ${consumedBgColor}">${person.consumedUnits.toFixed(1)}</td>
                                        <td class="border border-gray-200 px-3 py-3 text-center ${extraUnitsBgColor}">${person.extraUnits.toFixed(2)}</td>
                                        <td class="border border-gray-200 px-3 py-3 text-center ${extraCostBgColor}">PKR ${person.extraUnitsCost.toFixed(2)}</td>
                                        <td class="border border-gray-200 px-3 py-3 text-right font-semibold text-green-600">PKR ${person.totalBill.toFixed(2)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                        <tfoot>
                            <tr class="bg-gray-100 font-bold">
                                <td class="border border-gray-200 px-3 py-3">Total</td>
                                <td class="border border-gray-200 px-3 py-3 text-center">${totalShareUnits.toFixed(2)}</td>
                                <td class="border border-gray-200 px-3 py-3 text-center">${totalConsumedUnits.toFixed(1)}</td>
                                <td class="border border-gray-200 px-3 py-3 text-center">${totalExtraUnits.toFixed(2)}</td>
                                <td class="border border-gray-200 px-3 py-3 text-center">PKR ${totalExtraUnitsCost.toFixed(2)}</td>
                                <td class="border border-gray-200 px-3 py-3 text-right text-blue-600">PKR ${totalFinalBill.toFixed(2)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;

            document.getElementById('billResults').innerHTML = summaryHTML + tableHTML;
            document.getElementById('resultsSection').classList.remove('hidden');
            
            // Smooth scroll to results
            document.getElementById('resultsSection').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        function clearAll() {
            document.getElementById('totalBill').value = '';
            document.getElementById('totalUnits').value = '';
            people.forEach(person => {
                document.getElementById(person.id).value = '';
            });
            document.getElementById('resultsSection').classList.add('hidden');
        }

        function printBill() {
            window.print();
        }

        // Initialize the app
        initializePeopleGrid();

        // Add print styles
        const printStyles = `
            <style media="print">
                body { font-size: 10px; }
                .no-print { display: none !important; }
                .container { max-width: none; margin: 0; padding: 10px; }
                .bg-gradient-to-br { background: white !important; }
                .shadow-xl { box-shadow: none !important; }
                .rounded-2xl { border-radius: 0 !important; }
                .bg-gradient-to-r { background: #f3f4f6 !important; color: black !important; }
                .text-white { color: black !important; }
                table { font-size: 9px; }
                .bg-red-100 { background-color: #fee2e2 !important; }
                .bg-green-100 { background-color: #dcfce7 !important; }
                .bg-blue-100 { background-color: #dbeafe !important; }
            </style>
        `;
        document.head.insertAdjacentHTML('beforeend', printStyles);
    </script>
</body>
</html>